<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarkov Raid Planner v1.0 Beta</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Global Loading Screen -->
    <div id="globalLoadingScreen" class="global-loading-screen">
        <div class="loading-content">
            <h1 style="color: var(--eft-gold); margin-bottom: 20px; font-family: 'Rajdhani', sans-serif;">TARKOV RAID PLANNER</h1>
            <div class="loading-spinner-large">
                <div class="spinner-large"></div>
            </div>
            <div id="loadingStatus" style="color: var(--text-main); margin-top: 20px; font-size: 0.9rem;">Initializing...</div>
            <div class="loading-progress-container">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
            <div id="loadingDetails" style="color: var(--text-sub); margin-top: 10px; font-size: 0.75rem;"></div>
        </div>
    </div>
    
    <div class="container">
        <div class="header-row">
            <h1>Tarkov Raid Planner</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <!-- Edit Mode Badge (hidden by default) -->
                <div id="editModeBadge" class="edit-mode-badge" style="display: none;">
                    ‚úèÔ∏è EDIT MODE - Drag markers to correct | Click for notes
                </div>
                <!-- Auth Buttons -->
                <div id="authButtons" class="auth-buttons">
                    <button id="loginBtn" class="btn-tarkov" onclick="showLoginModal()" style="padding: 6px 12px; font-size: 0.75rem;">üîë Login</button>
                    <div id="userInfo" style="display: none; align-items: center; gap: 8px;">
                        <span id="userEmail" style="color: var(--text-sub); font-size: 0.75rem;"></span>
                        <button id="editModeBtn" class="edit-mode-toggle" onclick="toggleEditMode()" title="Toggle marker editing (Ctrl+Shift+E)">‚úèÔ∏è Edit Markers</button>
                        <button class="btn-tarkov" onclick="logout()" style="padding: 6px 12px; font-size: 0.75rem;">Logout</button>
                    </div>
                </div>
                <div class="config-buttons" style="display: flex; gap: 8px;">
                    <button class="btn-tarkov" onclick="exportConfig()" style="padding: 6px 12px; font-size: 0.75rem;" title="Export configuration">üì• Export</button>
                    <button class="btn-tarkov" onclick="showImportModal()" style="padding: 6px 12px; font-size: 0.75rem;" title="Import configuration">üì§ Import</button>
                    <button class="btn-tarkov" onclick="toggleShortcutsHelp()" style="padding: 6px 12px; font-size: 0.75rem;" title="Keyboard shortcuts (?)">‚å®Ô∏è</button>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
            </div>
        </div>
        
        <!-- Login Modal -->
        <div id="loginModal" class="modal-overlay" style="display: none;">
            <div class="modal-content" style="max-width: 400px;">
                <h5 style="color: var(--text-beige); margin-bottom: 20px;">üîë Contributor Login</h5>
                <div id="loginError" style="display: none; background: rgba(140, 59, 59, 0.3); border: 1px solid var(--eft-red); padding: 10px; margin-bottom: 15px; color: var(--eft-red); font-size: 0.85rem;"></div>
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-sub); font-size: 0.8rem; display: block; margin-bottom: 5px;">Email</label>
                    <input type="email" id="loginEmail" class="form-control-tarkov w-100" placeholder="your@email.com" style="padding: 10px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--text-sub); font-size: 0.8rem; display: block; margin-bottom: 5px;">Password</label>
                    <input type="password" id="loginPassword" class="form-control-tarkov w-100" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="padding: 10px;" onkeypress="if(event.key==='Enter')doLogin()">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn-tarkov" onclick="hideLoginModal()" style="padding: 8px 20px; background: var(--bg-dark);">Cancel</button>
                    <button class="btn-tarkov" onclick="doLogin()" id="loginSubmitBtn" style="padding: 8px 20px;">Login</button>
                </div>
                <p style="color: var(--text-sub); font-size: 0.75rem; margin-top: 15px; text-align: center;">
                    Contributors can correct marker positions.<br>
                    Contact admin for an account.
                </p>
            </div>
        </div>
        
        <!-- Import Modal -->
        <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: var(--bg-panel); border: 2px solid var(--border-gold); padding: 25px; max-width: 500px; width: 90%;">
                <h5 style="color: var(--text-beige); margin-bottom: 15px;">Import Configuration</h5>
                <p style="color: var(--text-sub); font-size: 0.85rem; margin-bottom: 15px;">Paste your share code or JSON below, or upload a file:</p>
                <textarea id="importTextarea" style="width: 100%; height: 150px; background: var(--bg-dark); border: 1px solid var(--border-dark); color: var(--text-main); padding: 10px; font-family: monospace; font-size: 0.8rem; resize: vertical;" placeholder="Paste share code or JSON here..."></textarea>
                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <label class="btn-tarkov" style="padding: 8px 15px; cursor: pointer;">
                        üìÅ Upload File
                        <input type="file" accept=".json" onchange="importFromFile(event)" style="display: none;">
                    </label>
                    <button class="btn-tarkov" onclick="importFromText()" style="padding: 8px 15px;">‚úì Apply</button>
                    <button class="btn-tarkov" onclick="hideImportModal()" style="padding: 8px 15px; background: var(--bg-dark);">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Export Modal -->
        <div id="exportModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: var(--bg-panel); border: 2px solid var(--border-gold); padding: 25px; max-width: 500px; width: 90%;">
                <h5 style="color: var(--text-beige); margin-bottom: 15px;">Export Configuration</h5>
                <p style="color: var(--text-sub); font-size: 0.85rem; margin-bottom: 10px;">Choose how to export your configuration:</p>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--text-beige); font-size: 0.85rem; display: block; margin-bottom: 8px;">üìã Share Code (for Discord, etc.):</label>
                    <textarea id="exportCode" readonly style="width: 100%; height: 80px; background: var(--bg-dark); border: 1px solid var(--border-dark); color: var(--text-main); padding: 10px; font-family: monospace; font-size: 0.75rem; resize: none;"></textarea>
                    <button class="btn-tarkov" onclick="copyExportCode()" style="margin-top: 8px; padding: 6px 15px; font-size: 0.85rem;">üìã Copy Code</button>
                </div>
                
                <div style="border-top: 1px solid var(--border-dark); padding-top: 15px; margin-top: 10px;">
                    <label style="color: var(--text-beige); font-size: 0.85rem; display: block; margin-bottom: 8px;">üíæ Download as file:</label>
                    <button class="btn-tarkov" onclick="downloadExportFile()" style="padding: 8px 15px;">üì• Download .json</button>
                </div>
                
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn-tarkov" onclick="hideExportModal()" style="padding: 8px 15px; background: var(--bg-dark);">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Raid Share Modal -->
        <div id="raidShareModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: var(--bg-panel); border: 1px solid var(--eft-gold); padding: 25px; max-width: 550px; width: 90%;">
                <h5 style="color: var(--eft-gold); margin-bottom: 15px;">üì§ Share Raid Plan</h5>
                
                <div id="raidShareSummary" style="background: var(--bg-dark); padding: 10px; margin-bottom: 15px; font-size: 0.85rem; border: 1px solid var(--border-dark);"></div>
                
                <!-- Import Code -->
                <div style="margin-bottom: 15px;">
                    <p class="text-sub small mb-2">üì¶ Import Code (for the app):</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="raidShareCode" class="form-control-tarkov" readonly style="flex: 1; font-family: monospace; font-size: 0.75rem;">
                        <button class="btn-tarkov" onclick="copyRaidCode()" style="padding: 8px 15px;">üìã Copy</button>
                    </div>
                </div>
                
                <!-- Discord Text -->
                <div style="margin-bottom: 15px;">
                    <p class="text-sub small mb-2">üí¨ Discord Message:</p>
                    <textarea id="raidShareText" class="form-control-tarkov" readonly style="width: 100%; height: 120px; font-family: monospace; font-size: 0.75rem; resize: none;"></textarea>
                    <button class="btn-tarkov w-100 mt-2" onclick="copyRaidText()" style="padding: 8px 15px;">üìã Copy for Discord</button>
                </div>
                
                <div style="text-align: right;">
                    <button class="btn-tarkov" onclick="hideRaidShareModal()" style="padding: 8px 15px; background: var(--bg-dark);">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Raid Import Modal -->
        <div id="raidImportModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: var(--bg-panel); border: 1px solid var(--eft-gold); padding: 25px; max-width: 500px; width: 90%;">
                <h5 style="color: var(--eft-gold); margin-bottom: 15px;">üì• Import Raid Plan</h5>
                <p class="text-sub small mb-3">Paste the raid code from your squadmate:</p>
                
                <input type="text" id="raidImportCode" class="form-control-tarkov w-100 mb-3" placeholder="Paste raid code here..." style="font-family: monospace;">
                
                <div id="raidImportPreview" style="display: none; background: var(--bg-dark); padding: 10px; margin-bottom: 15px; font-size: 0.85rem; border: 1px solid var(--border-dark);"></div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn-tarkov" onclick="hideRaidImportModal()" style="padding: 8px 15px; background: var(--bg-dark);">Cancel</button>
                    <button class="btn-tarkov" onclick="importRaidPlan()" id="btnImportRaid" style="padding: 8px 15px;">üéØ Load Raid</button>
                </div>
            </div>
        </div>
        
        <!-- Correction Dialog (for editing marker positions) -->
        <!-- Missing Markers Analysis Modal -->
        <div id="missingMarkersModal" class="modal-overlay" style="display: none;">
            <div class="modal-dialog" style="max-width: 900px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column;">
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid var(--border-dark);">
                    <h4 style="margin: 0;">üìã Missing Markers Analysis</h4>
                    <button class="btn-tarkov" onclick="closeMissingMarkersModal()" style="padding: 5px 10px;">‚úï</button>
                </div>
                <div class="modal-body" style="padding: 15px 20px; overflow-y: auto; flex: 1;">
                    <div class="text-sub mb-3">
                        Objectives that likely need map markers but don't have GPS coordinates yet.
                        <br>Types: visit, mark, find, locate, plantItem, place, pickup, extract
                    </div>
                    <div id="missingMarkersContent">
                        <div class="text-center text-sub">Loading analysis...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="correctionDialogOverlay" class="correction-dialog-overlay" style="display: none;">
            <div class="correction-dialog">
                <h4>üìç Save Marker Correction</h4>
                <div class="correction-quest-info">
                    <strong id="correctionQuestName">Quest Name</strong>
                    <div class="text-sub" style="font-size: 0.8rem;" id="correctionObjective">Objective description</div>
                </div>
                <div class="correction-coords">
                    <div class="coord-row">
                        <span class="label">Original:</span>
                        <span class="old-coords" id="correctionOldCoords">(0.0%, 0.0%)</span>
                    </div>
                    <div class="coord-row">
                        <span class="label">New:</span>
                        <span class="new-coords" id="correctionNewCoords">(0.0%, 0.0%)</span>
                    </div>
                    <div class="coord-row" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-dark);">
                        <span class="label">Delta:</span>
                        <span class="text-gold" id="correctionDelta">(+0.0%, +0.0%)</span>
                    </div>
                </div>
                <div class="correction-dialog-buttons">
                    <button class="btn-tarkov" onclick="cancelCorrection()" style="background: var(--bg-dark);">Cancel</button>
                    <button class="btn-tarkov" onclick="saveCorrection()" id="saveCorrectionBtn">üíæ Save Correction</button>
                </div>
                <p class="text-sub" style="font-size: 0.7rem; margin-top: 10px; text-align: center;">
                    Corrections are saved to the database and help improve marker accuracy for everyone.
                </p>
            </div>
        </div>
        
        <!-- Extract Correction Dialog -->
        <div id="extractCorrectionDialogOverlay" class="correction-dialog-overlay" style="display: none;">
            <div class="correction-dialog">
                <h4>üö™ Save Extract Correction</h4>
                <div class="correction-quest-info">
                    <strong id="extractCorrectionName">Extract Name</strong>
                    <div class="text-sub" style="font-size: 0.8rem;" id="extractCorrectionMap">Map: Shoreline</div>
                </div>
                
                <div class="extract-correction-mode-toggle">
                    <button id="extractModeSingle" class="active" onclick="setExtractCorrectionMode('single')">Single Extract</button>
                    <button id="extractModeAll" onclick="setExtractCorrectionMode('all')">All Extracts (Map)</button>
                </div>
                
                <div id="extractMoveAllInfo" class="extract-move-all-info" style="display: none;">
                    ‚ö†Ô∏è This will apply the same offset to ALL extracts on this map. Use this if all markers are shifted by the same amount.
                </div>
                
                <div class="correction-coords">
                    <div class="coord-row">
                        <span class="label">Delta (pixels):</span>
                        <span class="text-gold" id="extractCorrectionDelta">(+0, +0)</span>
                    </div>
                </div>
                
                <div class="correction-dialog-buttons">
                    <button class="btn-tarkov" onclick="cancelExtractCorrection()" style="background: var(--bg-dark);">Cancel</button>
                    <button class="btn-tarkov" onclick="saveExtractCorrection()" id="saveExtractCorrectionBtn">üíæ Save Correction</button>
                </div>
                <p class="text-sub" style="font-size: 0.7rem; margin-top: 10px; text-align: center;">
                    Corrections help calibrate extract positions for the SVG maps.
                </p>
            </div>
        </div>
        
        <!-- Marker Notes Dialog (for adding custom notes to markers) -->
        <div id="markerNotesDialogOverlay" class="correction-dialog-overlay" style="display: none;">
            <div class="correction-dialog" style="min-width: 400px;">
                <h4>üìù Edit Marker Note</h4>
                <div class="correction-quest-info">
                    <strong id="markerNoteName">Marker Name</strong>
                    <div class="text-sub" style="font-size: 0.8rem;" id="markerNoteType">Extract / Quest</div>
                </div>
                
                <div style="margin: 15px 0;">
                    <label style="font-size: 0.85rem; color: var(--text-sub); display: block; margin-bottom: 6px;">Custom Note:</label>
                    <textarea id="markerNoteText" class="form-control-tarkov" rows="3" placeholder="e.g., Flare needed, Key XYZ required, Danger zone..." style="width: 100%; resize: vertical;"></textarea>
                    <div class="text-sub" style="font-size: 0.7rem; margin-top: 4px;">This note will appear in the marker tooltip and popup.</div>
                </div>
                
                <div class="correction-dialog-buttons">
                    <button class="btn-tarkov" onclick="deleteMarkerNote()" id="deleteMarkerNoteBtn" style="background: var(--eft-red); margin-right: auto;">üóëÔ∏è Delete</button>
                    <button class="btn-tarkov" onclick="cancelMarkerNote()" style="background: var(--bg-dark);">Cancel</button>
                    <button class="btn-tarkov" onclick="saveMarkerNote()" id="saveMarkerNoteBtn">üíæ Save Note</button>
                </div>
            </div>
        </div>
        
        <div class="nav-tabs-tarkov">
            <div class="nav-tab active" onclick="switchTab('planner')">Mission Planner</div>
            <div class="nav-tab" onclick="switchTab('hideout')">Hideout</div>
            <div class="nav-tab" onclick="switchTab('penetration')">Pen Chart</div>
            <div class="nav-tab" onclick="switchTab('ammo')">Ammo</div>
            <div class="nav-tab" onclick="switchTab('weapons')">Weapons</div>
            <div class="nav-tab" onclick="switchTab('gear')">Gear</div>
            <div class="nav-tab" onclick="switchTab('attachments')">Attachments</div>
        </div>
        
        <!-- INVENTORY DASHBOARD -->
        <div id="inventoryDashboard" class="inventory-dashboard" style="display: none;">
            <div class="dashboard-toggle" onclick="toggleDashboard()">
                <span>üìä Inventory Overview</span>
                <span id="dashboardArrow">‚ñº</span>
            </div>
            <div id="dashboardContent" class="dashboard-content">
                <div class="dashboard-grid">
                    <div class="dashboard-item">
                        <span class="dash-label">Ammo</span>
                        <span class="dash-value" id="dash-ammo-count">0/0</span>
                        <span class="dash-percent" id="dash-ammo-pct">0%</span>
                        <span class="dash-value-rub" id="dash-ammo-value">0 ‚ÇΩ</span>
                    </div>
                    <div class="dashboard-item">
                        <span class="dash-label">Weapons</span>
                        <span class="dash-value" id="dash-weapons-count">0/0</span>
                        <span class="dash-percent" id="dash-weapons-pct">0%</span>
                        <span class="dash-value-rub" id="dash-weapons-value">0 ‚ÇΩ</span>
                    </div>
                    <div class="dashboard-item">
                        <span class="dash-label">Gear</span>
                        <span class="dash-value" id="dash-gear-count">0/0</span>
                        <span class="dash-percent" id="dash-gear-pct">0%</span>
                        <span class="dash-value-rub" id="dash-gear-value">0 ‚ÇΩ</span>
                    </div>
                    <div class="dashboard-item">
                        <span class="dash-label">Attachments</span>
                        <span class="dash-value" id="dash-attachments-count">0/0</span>
                        <span class="dash-percent" id="dash-attachments-pct">0%</span>
                        <span class="dash-value-rub" id="dash-attachments-value">0 ‚ÇΩ</span>
                    </div>
                    <div class="dashboard-item dashboard-total">
                        <span class="dash-label">TOTAL</span>
                        <span class="dash-value" id="dash-total-count">0</span>
                        <span class="dash-percent" id="dash-total-pct">0%</span>
                        <span class="dash-value-rub" id="dash-total-value">0 ‚ÇΩ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- MISSION PLANNER TAB -->
        <div id="tab-planner" class="tab-content active">
            <div class="row">
                <div class="col-lg-5">
                    <div class="tarkov-panel">
                        <h5>Select Tasks</h5>
                        <div class="search-box" style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" class="form-control-tarkov" placeholder="Search tasks..." id="questSearch" oninput="filterQuests()" style="flex: 1;">
                            <select id="levelFilter" class="form-select-tarkov" onchange="filterQuests()" style="width: auto; padding: 8px 12px; font-size: 0.85rem;">
                                <option value="0">All Levels</option>
                                <option value="5">‚â§ Lvl 5</option>
                                <option value="10">‚â§ Lvl 10</option>
                                <option value="15">‚â§ Lvl 15</option>
                                <option value="20">‚â§ Lvl 20</option>
                                <option value="25">‚â§ Lvl 25</option>
                                <option value="30">‚â§ Lvl 30</option>
                                <option value="40">‚â§ Lvl 40</option>
                                <option value="50">‚â§ Lvl 50</option>
                            </select>
                        </div>
                        <div class="quest-list-controls" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; margin-bottom: 8px; border-bottom: 1px solid var(--border-dark);">
                            <span class="text-sub small"><span id="selectedQuestCount">0</span> tasks selected</span>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 0.75rem; color: var(--text-sub);">
                                    <input type="checkbox" id="hideCompletedToggle" onchange="filterQuests()" style="width: 14px; height: 14px; accent-color: var(--eft-gold);">
                                    Hide done
                                </label>
                                <div class="group-toggle" style="display: flex; background: var(--bg-dark); border: 1px solid var(--border-dark); border-radius: 3px; overflow: hidden;">
                                    <button id="groupByTrader" class="group-toggle-btn active" onclick="setQuestGrouping('trader')" style="padding: 3px 8px; font-size: 0.7rem; border: none; background: var(--eft-gold); color: #000; cursor: pointer;">Trader</button>
                                    <button id="groupByMap" class="group-toggle-btn" onclick="setQuestGrouping('map')" style="padding: 3px 8px; font-size: 0.7rem; border: none; background: transparent; color: var(--text-sub); cursor: pointer;">Map</button>
                                </div>
                                <button class="btn-tarkov" onclick="deselectAllQuests()" style="padding: 4px 10px; font-size: 0.75rem;">Deselect All</button>
                            </div>
                        </div>
                        <div id="quest-loading" class="loading-spinner">
                            <div class="spinner"></div>
                            <div>Loading intel from command...</div>
                        </div>
                        <div id="quest-list" class="d-none" style="max-height: 500px; overflow-y: auto;"></div>
                        <div id="quest-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="tarkov-panel">
                        <h5>Tactical Map</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <select id="mapSelect" class="form-select-tarkov w-100" onchange="onMapChange()">
                                    <option value="customs">Customs</option>
                                    <option value="factory">Factory</option>
                                    <option value="groundzero">Ground Zero</option>
                                    <option value="interchange">Interchange</option>
                                    <option value="labs">The Lab</option>
                                    <option value="lighthouse">Lighthouse</option>
                                    <option value="reserve">Reserve</option>
                                    <option value="shoreline">Shoreline</option>
                                    <option value="streets">Streets of Tarkov</option>
                                    <option value="woods">Woods</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <button class="btn-tarkov w-100" onclick="planRaid()">Plan Raid</button>
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <button class="btn-tarkov w-100" onclick="showRaidExportModal()" style="font-size: 0.8rem; padding: 6px 10px;">üì§ Share Raid</button>
                            </div>
                            <div class="col-6">
                                <button class="btn-tarkov w-100" onclick="showRaidImportModal()" style="font-size: 0.8rem; padding: 6px 10px;">üì• Import Raid</button>
                            </div>
                        </div>
                        <div id="mapHint" class="map-hint" style="display: none;"></div>
                        
                        <!-- Multi-Map Tabs (dynamisch generiert) -->
                        <div id="multiMapTabs" class="multi-map-tabs" style="display: none;">
                            <div id="mapTabsContainer" class="map-tabs-container"></div>
                        </div>
                        
                        <!-- Map Overlay Controls - Extract Toggle with Legend -->
                        <div class="map-overlay-controls">
                            <label class="overlay-toggle" id="extractToggleLabel">
                                <input type="checkbox" id="showExtractsToggle" onchange="toggleExtracts()">
                                <span>üö™</span>
                                <span>Show Extracts</span>
                            </label>
                            <div class="extract-legend" id="extractLegend" style="display: none; margin-left: 15px;">
                                <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                                    <span style="width: 12px; height: 12px; background: #4CAF50; border-radius: 3px;"></span>
                                    <span style="font-size: 0.75rem; color: var(--text-sub);">PMC</span>
                                </span>
                                <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                                    <span style="width: 12px; height: 12px; background: #FFC107; border-radius: 3px;"></span>
                                    <span style="font-size: 0.75rem; color: var(--text-sub);">Scav</span>
                                </span>
                                <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                                    <span style="width: 12px; height: 12px; background: #2196F3; border-radius: 3px;"></span>
                                    <span style="font-size: 0.75rem; color: var(--text-sub);">Co-Op</span>
                                </span>
                                <span style="display: inline-flex; align-items: center; gap: 4px;">
                                    <span style="width: 12px; height: 12px; background: #f44336; border-radius: 3px;"></span>
                                    <span style="font-size: 0.75rem; color: var(--text-sub);">Restricted</span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- Marker Creator Panel -->
                        <div id="markerCreatorPanel" class="marker-creator-panel">
                            <h6>üéØ Create Quest Marker</h6>
                            <div class="creator-hint" id="markerCreatorHint">
                                Select an objective below, then click on the map to place the marker.
                            </div>
                            <select id="objectiveSelect" class="objective-select" onchange="onObjectiveSelectChange()">
                                <option value="">-- Select a quest objective --</option>
                            </select>
                            <div class="floor-select-row" id="floorSelectRow" style="display: none;">
                                <label>Floor:</label>
                                <select id="markerFloorSelect" class="objective-select" style="flex: 1;">
                                    <option value="ground">Ground</option>
                                </select>
                            </div>
                            <div class="btn-row">
                                <button class="btn-tarkov" onclick="cancelMarkerCreation()">‚ùå Cancel</button>
                                <button class="btn-tarkov" id="deleteMarkerBtn" onclick="deleteSelectedMarker()" style="display: none; background: rgba(140, 59, 59, 0.3);">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                        
                        <!-- Area Drawing Panel -->
                        <div id="areaDrawingPanel" class="area-drawing-panel">
                            <div class="area-panel-tabs">
                                <button class="area-tab active" onclick="switchAreaTab('draw')" id="areaTabDraw">üî≤ Draw</button>
                                <button class="area-tab" onclick="switchAreaTab('manage')" id="areaTabManage">üìã Manage</button>
                            </div>
                            
                            <!-- Draw Tab -->
                            <div id="areaDrawTab" class="area-tab-content active">
                                <div class="creator-hint" id="areaDrawingHint">
                                    Click on the map to add points. Close the shape by clicking near the first point or press "Complete".
                                </div>
                                <div class="area-input-row">
                                    <label>Name:</label>
                                    <input type="text" id="areaNameInput" placeholder="e.g. Marked Room, Dorms 314" />
                                </div>
                                <div class="area-input-row">
                                    <label>Color:</label>
                                    <input type="color" id="areaColorInput" value="#9E8F6B" />
                                    <select id="areaColorPreset" onchange="document.getElementById('areaColorInput').value = this.value">
                                        <option value="#9E8F6B">Gold</option>
                                        <option value="#4CAF50">Green</option>
                                        <option value="#2196F3">Blue</option>
                                        <option value="#F44336">Red</option>
                                        <option value="#9C27B0">Purple</option>
                                        <option value="#FF9800">Orange</option>
                                    </select>
                                </div>
                                <div class="area-input-row" id="areaFloorRow" style="display: none;">
                                    <label>Floor:</label>
                                    <select id="areaFloorSelect"></select>
                                </div>
                                <div class="area-points-info">
                                    Points: <span id="areaPointsCount">0</span> | 
                                    <button class="btn-sm" onclick="undoLastAreaPoint()">‚Ü© Undo</button>
                                </div>
                                <div class="btn-row">
                                    <button class="btn-tarkov" onclick="completeAreaDrawing()" id="completeAreaBtn" disabled>‚úÖ Complete</button>
                                </div>
                            </div>
                            
                            <!-- Manage Tab -->
                            <div id="areaManageTab" class="area-tab-content">
                                <div class="area-list-header">
                                    <span>Saved Areas on this Map</span>
                                    <button class="btn-sm" onclick="refreshAreasList()">üîÑ</button>
                                </div>
                                <div id="areasList" class="areas-list">
                                    <div class="areas-loading">Loading...</div>
                                </div>
                            </div>
                            
                            <div class="btn-row" style="margin-top: 10px; border-top: 1px solid var(--border-dark); padding-top: 10px;">
                                <button class="btn-tarkov" onclick="closeAreaPanel()">‚úñ Close</button>
                            </div>
                        </div>
                        
                        <div class="map-controls">
                            <span>Scroll to zoom | Drag to pan | Click markers for details</span>
                            <span class="marker-count" id="markerCount">0 markers</span>
                            <button class="btn-tarkov" onclick="toggleMarkerCreator()" id="markerCreatorBtn" title="Create new quest markers">üéØ Add Markers</button>
                            <button class="btn-tarkov" onclick="toggleAreaPanel()" id="areaDrawingBtn" title="Draw and manage custom areas">üî≤ Areas</button>
                            <button class="btn-tarkov" onclick="showMissingMarkersAnalysis()" title="Show objectives that need markers">üìã Missing</button>
                            <button class="btn-tarkov" onclick="resetMapView()">Reset View</button>
                        </div>
                        <div id="map">
                            <div id="floorTabs" class="floor-tabs" style="display: none;"></div>
                            <div id="otherFloorsHint" class="other-floors-hint" onclick="showOtherFloorsMarkers()">‚ö†Ô∏è <span id="otherFloorsCount">0</span> markers on other floors</div>
                        </div>
                        <div id="mapLegend" class="map-legend" style="display: none;">
                            <div class="legend-title">Quest Colors</div>
                            <div id="legendItems" class="legend-items"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="planning-result" class="tarkov-panel" style="display: none;">
                <h5>Mission Briefing</h5>
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-beige mb-3">Required Keys</h6>
                        <div id="required-keys"></div>
                    </div>
                    <div class="col-md-8" id="quest-item-tracker-section">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="text-beige mb-0">Quest Item Tracker</h6>
                            <div class="item-tracker-progress">
                                <span class="progress-text" id="tracker-progress">0/0</span>
                                <div class="progress-bar-mini">
                                    <div class="progress-fill" id="tracker-progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div id="quest-item-tracker"></div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6 class="text-beige mb-3">Unlocks</h6>
                        <div id="progression-list"></div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-beige mb-3">Objectives</h6>
                        <div id="mission-steps" style="max-height: none; overflow: visible;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HIDEOUT TRACKER TAB -->
        <div id="tab-hideout" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="tarkov-panel">
                        <h5>Hideout Upgrades</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control-tarkov w-100" placeholder="Search stations..." id="hideoutSearch" oninput="filterHideoutStations()">
                            </div>
                            <div class="col-md-4">
                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85rem; color: var(--text-sub); height: 100%;">
                                    <input type="checkbox" id="hideCompletedStations" onchange="filterHideoutStations()" style="width: 16px; height: 16px; accent-color: var(--eft-gold);">
                                    Hide maxed stations
                                </label>
                            </div>
                            <div class="col-md-4">
                                <button class="btn-tarkov w-100" onclick="loadHideoutData()" id="btn-refresh-hideout">üîÑ Refresh</button>
                            </div>
                        </div>
                        <div class="hideout-progress-bar mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="text-sub small">Overall Progress</span>
                                <span class="text-gold" id="hideout-progress-text">0 / 0 Levels</span>
                            </div>
                            <div style="background: var(--bg-dark); border: 1px solid var(--border-dark); height: 8px;">
                                <div id="hideout-progress-fill" style="background: var(--eft-gold); height: 100%; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div id="hideout-loading" class="loading-spinner">
                            <div class="spinner"></div>
                            <div>Loading hideout data...</div>
                        </div>
                        <div id="hideout-content" class="d-none">
                            <div id="hideout-stations-list" style="max-height: 600px; overflow-y: auto;"></div>
                        </div>
                        <div id="hideout-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="tarkov-panel">
                        <h5>üìã Shopping List</h5>
                        <p class="text-sub small mb-3">Items needed for next upgrades</p>
                        <div id="hideout-shopping-list" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-sub text-center p-3">Select a target level to see required items</div>
                        </div>
                    </div>
                    <div class="tarkov-panel mt-3">
                        <h5>üìä Station Stats</h5>
                        <div id="hideout-stats">
                            <div class="d-flex justify-content-between py-2 border-bottom" style="border-color: var(--border-dark) !important;">
                                <span class="text-sub">Stations</span>
                                <span class="text-beige" id="stat-stations-count">0</span>
                            </div>
                            <div class="d-flex justify-content-between py-2 border-bottom" style="border-color: var(--border-dark) !important;">
                                <span class="text-sub">Completed</span>
                                <span class="text-gold" id="stat-completed-count">0</span>
                            </div>
                            <div class="d-flex justify-content-between py-2 border-bottom" style="border-color: var(--border-dark) !important;">
                                <span class="text-sub">In Progress</span>
                                <span class="text-beige" id="stat-inprogress-count">0</span>
                            </div>
                            <div class="d-flex justify-content-between py-2">
                                <span class="text-sub">Not Started</span>
                                <span class="text-sub" id="stat-notstarted-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AMMO MANAGER TAB -->
        <div id="tab-ammo" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="tarkov-panel">
                        <h5>Ammunition Database</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <select id="caliberFilter" class="form-select-tarkov w-100" onchange="filterAmmoByCaliber()">
                                    <option value="ALL">All Calibers</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="search-box">
                                    <input type="text" class="form-control-tarkov w-100" placeholder="Search ammo..." id="ammoSearch" oninput="filterAmmoBySearch()">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button id="btn-load-ammo" class="btn-tarkov w-100" onclick="loadAmmoData()" style="display: none;">üîÑ Refresh Data</button>
                            </div>
                            <div class="col-md-2">
                                <button id="bulk-toggle-ammo" class="btn-tarkov w-100" onclick="toggleBulkMode('ammo')" style="font-size: 0.75rem;">Bulk Select</button>
                            </div>
                        </div>
                        <div class="bulk-controls" id="bulk-controls-ammo">
                            <span id="bulk-count-ammo" class="text-beige">0 selected</span>
                            <button class="btn-tarkov" onclick="bulkMarkOwned('ammo')" style="padding: 4px 10px; font-size: 0.75rem;">‚úì Mark Owned</button>
                            <button class="btn-tarkov" onclick="bulkUnmarkOwned('ammo')" style="padding: 4px 10px; font-size: 0.75rem;">‚úó Unmark</button>
                            <button class="btn-tarkov" onclick="bulkSelectAll('ammo')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Select All</button>
                            <button class="btn-tarkov" onclick="bulkDeselectAll('ammo')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Deselect All</button>
                        </div>
                        <div class="text-sub small mb-3">Click ammo to mark as owned | <span id="ammo-count">0</span> loaded</div>
                        <div id="ammo-loading" class="loading-spinner d-none">
                            <div class="spinner"></div>
                            <div>Loading ammunition data...</div>
                        </div>
                        <div id="ammo-content" class="d-none">
                            <div id="ammo-list" style="max-height: 500px; overflow-y: auto;"></div>
                        </div>
                        <div id="ammo-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="tarkov-panel">
                        <h5>Tier Configuration</h5>
                        <div class="tier-config" id="tierConfigAmmo">
                            <div class="stat-selector">
                                <label>Active Stats (OR logic):</label>
                                <div class="stat-checkboxes" id="ammoStatCheckboxes"></div>
                            </div>
                            <div class="threshold-editor">
                                <div class="threshold-editor-header">
                                    <span class="text-sub small">Edit:</span>
                                    <select id="ammoStatSelect" onchange="renderThresholdEditor('ammo')"></select>
                                    <span class="threshold-direction" id="ammoStatDirection"></span>
                                </div>
                                <div class="threshold-grid" id="ammoThresholdGrid"></div>
                            </div>
                            <div class="tier-config-row mt-3">
                                <span class="tier-badge tier-F">F</span>
                                <label>Below all D thresholds</label>
                            </div>
                            <div class="mt-2 d-flex gap-2">
                                <button class="btn-tarkov flex-grow-1" onclick="resetCategoryConfig('ammo')" style="padding: 6px 12px; font-size: 0.8rem;">Reset</button>
                                <button class="btn-tarkov flex-grow-1" onclick="clearCategoryOverrides('ammo')" style="padding: 6px 12px; font-size: 0.8rem;">Clear Overrides</button>
                            </div>
                        </div>
                    </div>
                    <div class="tarkov-panel">
                        <h5>Keep/Sell Analysis</h5>
                        <div class="mb-3">
                            <label class="form-label text-sub small">Minimum tier to keep:</label>
                            <input type="range" class="form-range" id="ammoTierSlider" min="0" max="5" value="2" oninput="updateKeepThreshold('ammo')">
                            <div class="text-center text-beige" id="ammoTierDisplay">Keep B-Tier+</div>
                        </div>
                        <div class="analysis-panel" style="flex-direction: column;">
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(74, 122, 74, 0.2);">
                                    <h6 style="color: var(--eft-green);">KEEP</h6>
                                    <span class="badge-tarkov badge-active" id="ammo-keep-count">0</span>
                                </div>
                                <div id="ammo-keep-list" class="analysis-list"></div>
                            </div>
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(140, 59, 59, 0.2);">
                                    <h6 style="color: var(--eft-red);">SELL</h6>
                                    <span class="badge-tarkov" id="ammo-sell-count">0</span>
                                </div>
                                <div id="ammo-sell-list" class="analysis-list"></div>
                                <div class="text-end mt-2 text-sub small">Total value: <span id="ammo-total-sell-value" class="text-gold">0 RUB</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PENETRATION CHART TAB -->
        <div id="tab-penetration" class="tab-content">
            <div class="tarkov-panel">
                <h5>Ammo Penetration vs Armor Class</h5>
                <p class="text-sub small mb-3">Shows effectiveness of ammunition against different armor classes. Data loaded from Ammo tab.</p>
                
                <div class="pen-legend">
                    <div class="pen-legend-item"><div class="pen-legend-color" style="background: rgba(74, 140, 74, 0.4);"></div> High penetration (6+ shots effective)</div>
                    <div class="pen-legend-item"><div class="pen-legend-color" style="background: rgba(180, 150, 50, 0.4);"></div> Medium (3-5 shots needed)</div>
                    <div class="pen-legend-item"><div class="pen-legend-color" style="background: rgba(140, 60, 60, 0.4);"></div> Low (many shots needed)</div>
                    <div class="pen-legend-item"><div class="pen-legend-color" style="background: rgba(60, 60, 60, 0.3);"></div> Ineffective</div>
                </div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <select id="penCaliberFilter" class="form-select-tarkov w-100" onchange="renderPenMatrix()">
                            <option value="ALL">All Calibers</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select id="penSortBy" class="form-select-tarkov w-100" onchange="renderPenMatrix()">
                            <option value="pen">Sort by Penetration</option>
                            <option value="name">Sort by Name</option>
                            <option value="damage">Sort by Damage</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="text-sub small d-flex align-items-center gap-2">
                            <input type="checkbox" id="penShowOwned" onchange="renderPenMatrix()"> Show only owned
                        </label>
                    </div>
                </div>
                
                <div id="pen-loading" class="text-sub text-center p-4">
                    Load ammo data in the Ammo tab first to see the penetration chart.
                </div>
                <div id="pen-matrix-container" class="pen-matrix-container d-none"></div>
            </div>
        </div>

        <!-- WEAPONS TAB -->
        <div id="tab-weapons" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="tarkov-panel">
                        <h5>Weapons Database</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <select id="weaponTypeFilter" class="form-select-tarkov w-100" onchange="filterWeapons()">
                                    <option value="ALL">All Types</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control-tarkov w-100" placeholder="Search weapons..." id="weaponSearch" oninput="filterWeapons()">
                            </div>
                            <div class="col-md-3">
                                <button id="btn-load-weapons" class="btn-tarkov w-100" onclick="loadWeaponsData()" style="display: none;">üîÑ Refresh Data</button>
                            </div>
                            <div class="col-md-2">
                                <button id="bulk-toggle-weapons" class="btn-tarkov w-100" onclick="toggleBulkMode('weapons')" style="font-size: 0.75rem;">Bulk Select</button>
                            </div>
                        </div>
                        <div class="bulk-controls" id="bulk-controls-weapons">
                            <span id="bulk-count-weapons" class="text-beige">0 selected</span>
                            <button class="btn-tarkov" onclick="bulkMarkOwned('weapons')" style="padding: 4px 10px; font-size: 0.75rem;">‚úì Mark Owned</button>
                            <button class="btn-tarkov" onclick="bulkUnmarkOwned('weapons')" style="padding: 4px 10px; font-size: 0.75rem;">‚úó Unmark</button>
                            <button class="btn-tarkov" onclick="bulkSelectAll('weapons')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Select All</button>
                            <button class="btn-tarkov" onclick="bulkDeselectAll('weapons')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Deselect All</button>
                        </div>
                        <div class="text-sub small mb-3">Click weapon to mark as owned | <span id="weapon-count">0</span> loaded</div>
                        <div id="weapons-loading" class="loading-spinner d-none">
                            <div class="spinner"></div>
                            <div>Loading weapons data...</div>
                        </div>
                        <div id="weapons-content" class="d-none">
                            <div id="weapons-list" style="max-height: 500px; overflow-y: auto;"></div>
                        </div>
                        <div id="weapons-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="tarkov-panel">
                        <h5>Weapon Tier Config</h5>
                        <div class="tier-config" id="tierConfigWeapons">
                            <div class="stat-selector">
                                <label>Active Stats (OR logic):</label>
                                <div class="stat-checkboxes" id="weaponsStatCheckboxes"></div>
                            </div>
                            <div class="threshold-editor">
                                <div class="threshold-editor-header">
                                    <span class="text-sub small">Edit:</span>
                                    <select id="weaponsStatSelect" onchange="renderThresholdEditor('weapons')"></select>
                                    <span class="threshold-direction" id="weaponsStatDirection"></span>
                                </div>
                                <div class="threshold-grid" id="weaponsThresholdGrid"></div>
                            </div>
                            <div class="tier-config-row mt-3">
                                <span class="tier-badge tier-F">F</span>
                                <label>Below all D thresholds</label>
                            </div>
                            <div class="mt-2 d-flex gap-2">
                                <button class="btn-tarkov flex-grow-1" onclick="resetCategoryConfig('weapons')" style="padding: 6px 12px; font-size: 0.8rem;">Reset</button>
                                <button class="btn-tarkov flex-grow-1" onclick="clearCategoryOverrides('weapons')" style="padding: 6px 12px; font-size: 0.8rem;">Clear Overrides</button>
                            </div>
                        </div>
                    </div>
                    <div class="tarkov-panel">
                        <h5>Keep/Sell Analysis</h5>
                        <div class="mb-3">
                            <label class="form-label text-sub small">Minimum tier to keep:</label>
                            <input type="range" class="form-range" id="weaponsTierSlider" min="0" max="5" value="2" oninput="updateKeepThreshold('weapons')">
                            <div class="text-center text-beige" id="weaponsTierDisplay">Keep B-Tier+</div>
                        </div>
                        <div class="analysis-panel" style="flex-direction: column;">
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(74, 122, 74, 0.2);"><h6 style="color: var(--eft-green);">KEEP</h6><span class="badge-tarkov badge-active" id="weapons-keep-count">0</span></div>
                                <div id="weapons-keep-list" class="analysis-list"></div>
                            </div>
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(140, 59, 59, 0.2);"><h6 style="color: var(--eft-red);">SELL</h6><span class="badge-tarkov" id="weapons-sell-count">0</span></div>
                                <div id="weapons-sell-list" class="analysis-list"></div>
                                <div class="text-end mt-2 text-sub small">Total value: <span id="weapons-total-sell-value" class="text-gold">0 RUB</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GEAR TAB -->
        <div id="tab-gear" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="tarkov-panel">
                        <h5>Gear Database</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <select id="gearTypeFilter" class="form-select-tarkov w-100" onchange="filterGear()">
                                    <option value="ALL">All Types</option>
                                    <option value="armor">Body Armor</option>
                                    <option value="helmet">Helmets</option>
                                    <option value="rig">Tactical Rigs</option>
                                    <option value="backpack">Backpacks</option>
                                    <option value="headphones">Headsets</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control-tarkov w-100" placeholder="Search gear..." id="gearSearch" oninput="filterGear()">
                            </div>
                            <div class="col-md-3">
                                <button id="btn-load-gear" class="btn-tarkov w-100" onclick="loadGearData()" style="display: none;">üîÑ Refresh Data</button>
                            </div>
                            <div class="col-md-2">
                                <button id="bulk-toggle-gear" class="btn-tarkov w-100" onclick="toggleBulkMode('gear')" style="font-size: 0.75rem;">Bulk Select</button>
                            </div>
                        </div>
                        <div class="bulk-controls" id="bulk-controls-gear">
                            <span id="bulk-count-gear" class="text-beige">0 selected</span>
                            <button class="btn-tarkov" onclick="bulkMarkOwned('gear')" style="padding: 4px 10px; font-size: 0.75rem;">‚úì Mark Owned</button>
                            <button class="btn-tarkov" onclick="bulkUnmarkOwned('gear')" style="padding: 4px 10px; font-size: 0.75rem;">‚úó Unmark</button>
                            <button class="btn-tarkov" onclick="bulkSelectAll('gear')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Select All</button>
                            <button class="btn-tarkov" onclick="bulkDeselectAll('gear')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Deselect All</button>
                        </div>
                        <div class="text-sub small mb-3">Click gear to mark as owned | <span id="gear-count">0</span> loaded</div>
                        <div id="gear-loading" class="loading-spinner d-none">
                            <div class="spinner"></div>
                            <div>Loading gear data...</div>
                        </div>
                        <div id="gear-content" class="d-none">
                            <div id="gear-list" style="max-height: 500px; overflow-y: auto;"></div>
                        </div>
                        <div id="gear-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="tarkov-panel">
                        <h5>Gear Tier Config</h5>
                        <div class="tier-config" id="tierConfigGear">
                            <div class="stat-selector">
                                <label>Active Stats (OR logic):</label>
                                <div class="stat-checkboxes" id="gearStatCheckboxes"></div>
                            </div>
                            <div class="threshold-editor">
                                <div class="threshold-editor-header">
                                    <span class="text-sub small">Edit:</span>
                                    <select id="gearStatSelect" onchange="renderThresholdEditor('gear')"></select>
                                    <span class="threshold-direction" id="gearStatDirection"></span>
                                </div>
                                <div class="threshold-grid" id="gearThresholdGrid"></div>
                            </div>
                            <div class="tier-config-row mt-3">
                                <span class="tier-badge tier-F">F</span>
                                <label>Below all D thresholds</label>
                            </div>
                            <div class="mt-2 d-flex gap-2">
                                <button class="btn-tarkov flex-grow-1" onclick="resetCategoryConfig('gear')" style="padding: 6px 12px; font-size: 0.8rem;">Reset</button>
                                <button class="btn-tarkov flex-grow-1" onclick="clearCategoryOverrides('gear')" style="padding: 6px 12px; font-size: 0.8rem;">Clear Overrides</button>
                            </div>
                        </div>
                    </div>
                    <div class="tarkov-panel">
                        <h5>Keep/Sell Analysis</h5>
                        <div class="mb-3">
                            <label class="form-label text-sub small">Minimum tier to keep:</label>
                            <input type="range" class="form-range" id="gearTierSlider" min="0" max="5" value="2" oninput="updateKeepThreshold('gear')">
                            <div class="text-center text-beige" id="gearTierDisplay">Keep B-Tier+</div>
                        </div>
                        <div class="analysis-panel" style="flex-direction: column;">
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(74, 122, 74, 0.2);"><h6 style="color: var(--eft-green);">KEEP</h6><span class="badge-tarkov badge-active" id="gear-keep-count">0</span></div>
                                <div id="gear-keep-list" class="analysis-list"></div>
                            </div>
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(140, 59, 59, 0.2);"><h6 style="color: var(--eft-red);">SELL</h6><span class="badge-tarkov" id="gear-sell-count">0</span></div>
                                <div id="gear-sell-list" class="analysis-list"></div>
                                <div class="text-end mt-2 text-sub small">Total value: <span id="gear-total-sell-value" class="text-gold">0 RUB</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ATTACHMENTS TAB -->
        <div id="tab-attachments" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="tarkov-panel">
                        <h5>Attachments Database</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <select id="attachmentTypeFilter" class="form-select-tarkov w-100" onchange="filterAttachments()">
                                    <option value="ALL">All Types</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control-tarkov w-100" placeholder="Search attachments..." id="attachmentSearch" oninput="filterAttachments()">
                            </div>
                            <div class="col-md-3">
                                <button id="btn-load-attachments" class="btn-tarkov w-100" onclick="loadAttachmentsData()" style="display: none;">üîÑ Refresh Data</button>
                            </div>
                            <div class="col-md-2">
                                <button id="bulk-toggle-attachments" class="btn-tarkov w-100" onclick="toggleBulkMode('attachments')" style="font-size: 0.75rem;">Bulk Select</button>
                            </div>
                        </div>
                        <div class="bulk-controls" id="bulk-controls-attachments">
                            <span id="bulk-count-attachments" class="text-beige">0 selected</span>
                            <button class="btn-tarkov" onclick="bulkMarkOwned('attachments')" style="padding: 4px 10px; font-size: 0.75rem;">‚úì Mark Owned</button>
                            <button class="btn-tarkov" onclick="bulkUnmarkOwned('attachments')" style="padding: 4px 10px; font-size: 0.75rem;">‚úó Unmark</button>
                            <button class="btn-tarkov" onclick="bulkSelectAll('attachments')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Select All</button>
                            <button class="btn-tarkov" onclick="bulkDeselectAll('attachments')" style="padding: 4px 10px; font-size: 0.75rem; background: var(--bg-dark);">Deselect All</button>
                        </div>
                        <div class="text-sub small mb-3">Click attachment to mark as owned | <span id="attachment-count">0</span> loaded</div>
                        <div id="attachments-loading" class="loading-spinner d-none">
                            <div class="spinner"></div>
                            <div>Loading attachments data...</div>
                        </div>
                        <div id="attachments-content" class="d-none">
                            <div id="attachments-list" style="max-height: 500px; overflow-y: auto;"></div>
                        </div>
                        <div id="attachments-error" class="alert alert-danger d-none"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="tarkov-panel">
                        <h5>Attachment Tier Config</h5>
                        <div class="tier-config" id="tierConfigAttachments">
                            <div class="stat-selector">
                                <label>Active Stats (OR logic):</label>
                                <div class="stat-checkboxes" id="attachmentsStatCheckboxes"></div>
                            </div>
                            <div class="threshold-editor">
                                <div class="threshold-editor-header">
                                    <span class="text-sub small">Edit:</span>
                                    <select id="attachmentsStatSelect" onchange="renderThresholdEditor('attachments')"></select>
                                    <span class="threshold-direction" id="attachmentsStatDirection"></span>
                                </div>
                                <div class="threshold-grid" id="attachmentsThresholdGrid"></div>
                            </div>
                            <div class="tier-config-row mt-3">
                                <span class="tier-badge tier-F">F</span>
                                <label>Below all D thresholds</label>
                            </div>
                            <div class="mt-2 d-flex gap-2">
                                <button class="btn-tarkov flex-grow-1" onclick="resetCategoryConfig('attachments')" style="padding: 6px 12px; font-size: 0.8rem;">Reset</button>
                                <button class="btn-tarkov flex-grow-1" onclick="clearCategoryOverrides('attachments')" style="padding: 6px 12px; font-size: 0.8rem;">Clear Overrides</button>
                            </div>
                        </div>
                    </div>
                    <div class="tarkov-panel">
                        <h5>Keep/Sell Analysis</h5>
                        <div class="mb-3">
                            <label class="form-label text-sub small">Minimum tier to keep:</label>
                            <input type="range" class="form-range" id="attachmentsTierSlider" min="0" max="5" value="2" oninput="updateKeepThreshold('attachments')">
                            <div class="text-center text-beige" id="attachmentsTierDisplay">Keep B-Tier+</div>
                        </div>
                        <div class="analysis-panel" style="flex-direction: column;">
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(74, 122, 74, 0.2);"><h6 style="color: var(--eft-green);">KEEP</h6><span class="badge-tarkov badge-active" id="attachments-keep-count">0</span></div>
                                <div id="attachments-keep-list" class="analysis-list"></div>
                            </div>
                            <div class="analysis-col">
                                <div class="analysis-header" style="background: rgba(140, 59, 59, 0.2);"><h6 style="color: var(--eft-red);">SELL</h6><span class="badge-tarkov" id="attachments-sell-count">0</span></div>
                                <div id="attachments-sell-list" class="analysis-list"></div>
                                <div class="text-end mt-2 text-sub small">Total value: <span id="attachments-total-sell-value" class="text-gold">0 RUB</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Application Scripts (order matters!) -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/markers.js"></script>
    <script src="js/quests.js"></script>
    <script src="js/hideout.js"></script>
    <script src="js/map.js"></script>
    <script src="js/raids.js"></script>
    <script src="js/items.js"></script>
    <script src="js/overlays.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
